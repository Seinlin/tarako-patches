From e973a659d15cad66fdfc03226e4ef14e52e88a82 Mon Sep 17 00:00:00 2001
From: vincentliu <vliu@mozilla.com>
Date: Mon, 10 Feb 2014 12:53:32 +0800
Subject: [PATCH] Modify 0009-Bug-948276-Lazy-load-accessibility-support.patch
 due to some patches has landed.

---
 b2g/chrome/content/settings.js |   41 +++-------------------------------------
 1 file changed, 3 insertions(+), 38 deletions(-)

diff --git a/b2g/chrome/content/settings.js b/b2g/chrome/content/settings.js
index 88102e2..24d659d 100644
--- a/b2g/chrome/content/settings.js
+++ b/b2g/chrome/content/settings.js
@@ -527,6 +527,9 @@ SettingsListener.observe("debug.paint-flashing.enabled", false, function(value)
 SettingsListener.observe("layers.draw-borders", false, function(value) {
   Services.prefs.setBoolPref("layers.draw-borders", value);
 });
+SettingsListener.observe("layers.composer2d.enabled", true, function(value) {
+  Services.prefs.setBoolPref("layers.composer2d.enabled", value);
+});
 
 // ================ Accessibility ============
 SettingsListener.observe("accessibility.screenreader", false, function(value) {
@@ -536,44 +539,6 @@ SettingsListener.observe("accessibility.screenreader", false, function(value) {
   }
 });
 
-(function Composer2DSettingToPref() {
-  //layers.composer.enabled can be toggled in three ways
-  //In order of precedence they are:
-  //First: layers.composer.enabled mozSetting
-  //Second: layers.composer.enabled gecko pref
-  //Third: ro.display.colorfill gonk prop
-
-  var req = navigator.mozSettings.createLock().get('layers.composer2d.enabled');
-  req.onsuccess = function() {
-    if(typeof(req.result['layers.composer2d.enabled']) == 'undefined') {
-      var enabled = false;
-      if (Services.prefs.getPrefType('layers.composer2d.enabled') == Ci.nsIPrefBranch.PREF_BOOL) {
-        enabled = Services.prefs.getBoolPref('layers.composer2d.enabled');
-      }
-      else {
-#ifdef MOZ_WIDGET_GONK
-        if (libcutils.property_get('ro.display.colorfill') == 1) {
-          enabled = true;
-        }
-        else {
-          enabled = false;
-        }
-#endif
-      }
-      navigator.mozSettings.createLock().set(
-        {'layers.composer2d.enabled': enabled});
-    }
-
-    SettingsListener.observe("layers.composer2d.enabled", true, function(value) {
-      Services.prefs.setBoolPref("layers.composer2d.enabled", value);
-    });
-  };
-  req.onerror = function() {
-    dump("Error configuring layers.composer2d.enabled setting");
-  };
-
-})();
-
 // =================== AsyncPanZoom ======================
 
 SettingsListener.observe('apz.force-enable', false, function(value) {
-- 
1.7.9.5

